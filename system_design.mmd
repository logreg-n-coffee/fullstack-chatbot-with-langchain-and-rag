graph TD
  %% Define Colors
  classDef user fill:#ffcc00,stroke:#333,stroke-width:2px;
  classDef frontend fill:#ff9900,stroke:#333,stroke-width:2px;
  classDef aws fill:#ff6600,stroke:#333,stroke-width:2px;
  classDef storage fill:#ff3300,stroke:#333,stroke-width:2px;
  classDef output fill:#ff0000,stroke:#333,stroke-width:2px;
  classDef management fill:#cc0000,stroke:#333,stroke-width:2px;

  %% User Interaction
  A[User Interface] -->|Interacts| B[Frontend Application]
  class A,B user

  %% Frontend
  B -->|Sends request to| C[API Gateway]
  class C aws

  %% AWS Infrastructure
  C -->|Triggers| D[AWS Lambda Function]

  subgraph AWS_Lambda_Function
    D -->|Fetches data from| E[RDS PostgreSQL]
    D -->|Fetches cached data from| G[ElastiCache Redis]
    D -->|Returns response to| C
    D -->|Retrieval and Processing| L[LLM with RAG]
    class D aws
  end

  subgraph RDS_PostgreSQL
    E -->|Stores documents and vectors| H[Documents Table]
    E -->|Utilizes| F[pgvector Extension]
    H --> L
    class E,H,F aws
  end

  %% Storage
  G -->|Stores cached responses| G1[Redis Cache]
  G --> L
  class G,G1 storage

  %% LLM and RAG Processing
  L -->|Generates Response| K[Cache and Return Response]
  K -->|Caches response in Redis| G1
  K -->|Sends back to API Gateway| C
  class L,K aws

  %% Output
  C -->|Returns response to| B
  class B output

  %% Management
  I[Terraform] -->|Provisions resources| AWS[All AWS Services]
  class I,AWS management
